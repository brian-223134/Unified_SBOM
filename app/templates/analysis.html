<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <title>SBOM ë¶„ì„ ë¦¬í¬íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden-row { display: none; }
        .cicd-hidden { display: none !important; }
    </style>
</head>
<body class="bg-slate-50">
    <div class="container mx-auto py-10 px-4">
        <div class="mb-6 flex justify-between items-end">
            <div>
                <a href="/" class="text-indigo-600 hover:underline text-sm">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                <h1 class="text-3xl font-bold text-slate-800 mt-2">ğŸ” SBOM ë¶„ì„ ë¦¬í¬íŠ¸</h1>
            </div>
            <div class="text-right">
                <p class="text-slate-500 text-sm mb-2 font-mono">{{ result.filename }}</p>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="cicd-filter" class="sr-only peer" onchange="filterRows()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                    <span class="ml-3 text-sm font-bold text-indigo-700">CI/CD í•­ëª© ìˆ¨ê¸°ê¸°</span>
                </label>
            </div>
        </div>

        <!-- ì£¼ìš” í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 mb-1">ì´ íƒì§€ íŒ¨í‚¤ì§€</p>
                <p class="text-3xl font-bold text-indigo-600">{{ result.total_packages }} <span class="text-lg text-slate-400 font-normal">ê°œ</span></p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 mb-1">CI/CD ê´€ë ¨ íŒ¨í‚¤ì§€</p>
                <p class="text-3xl font-bold text-amber-600">{{ result.cicd_count }} <span class="text-lg text-slate-400 font-normal">ê°œ</span></p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 mb-1">ê³ ìœ  ë¼ì´ì„ ìŠ¤</p>
                <p class="text-3xl font-bold text-emerald-600">{{ result.unique_licenses }} <span class="text-lg text-slate-400 font-normal">ì¢…ë¥˜</span></p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <p class="text-sm text-slate-500 mb-1">ì˜ì¡´ì„± ê´€ê³„</p>
                <p class="text-3xl font-bold text-rose-600">{{ result.total_dependencies }} <span class="text-lg text-slate-400 font-normal">ê°œ</span></p>
            </div>
        </div>

        <!-- ë„êµ¬ ë° ë©”íƒ€ë°ì´í„° ì •ë³´ -->
        <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">ğŸ“‹ ë¶„ì„ ì •ë³´</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <p class="text-sm text-slate-500">ë¶„ì„ ë„êµ¬</p>
                    <p class="text-lg font-semibold text-slate-800 capitalize">{{ result.tool_name }}</p>
                    {% if result.tool_version != "Unknown" %}
                    <p class="text-sm text-slate-400">v{{ result.tool_version }}</p>
                    {% endif %}
                </div>
                <div>
                    <p class="text-sm text-slate-500">ëŒ€ìƒ í”„ë¡œì íŠ¸</p>
                    <p class="text-lg font-semibold text-slate-800">{{ result.target_name }}</p>
                    <p class="text-sm text-slate-400">{{ result.target_type }}</p>
                </div>
                <div>
                    <p class="text-sm text-slate-500">ìƒì„± ì‹œê°„</p>
                    <p class="text-sm text-slate-600 font-mono">{{ result.timestamp }}</p>
                </div>
            </div>
        </div>

        <!-- ë¼ì´ì„ ìŠ¤ í†µê³„ -->
        <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">ğŸ“ ë¼ì´ì„ ìŠ¤ í†µê³„ (ìƒìœ„ 10ê°œ)</h2>
            <div class="space-y-3">
                {% for license, count in result.license_stats %}
                <div class="flex justify-between items-center">
                    <span class="text-slate-700 font-medium">{{ license }}</span>
                    <div class="flex items-center">
                        <div class="w-32 bg-slate-200 rounded-full h-2 mr-3">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: {{ (count / result.total_packages * 100) | round(1) }}%"></div>
                        </div>
                        <span class="text-sm text-slate-500 font-mono">{{ count }}ê°œ</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- íŒ¨í‚¤ì§€ íƒ€ì… í†µê³„ -->
        <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">ğŸ“¦ íŒ¨í‚¤ì§€ íƒ€ì…ë³„ ë¶„í¬</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for pkg_type, count in result.type_stats %}
                <div class="bg-slate-50 p-4 rounded-lg border">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-700 font-medium capitalize">{{ pkg_type }}</span>
                        <span class="bg-slate-200 px-3 py-1 rounded-full text-sm font-semibold">{{ count }}ê°œ</span>
                    </div>
                    <div class="mt-2 w-full bg-slate-200 rounded-full h-2">
                        <div class="bg-emerald-500 h-2 rounded-full" style="width: {{ (count / result.total_packages * 100) | round(1) }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ë³´ì•ˆ ë° ë¬´ê²°ì„± ì •ë³´ -->
        <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">ğŸ”’ ë³´ì•ˆ ë° ë¬´ê²°ì„±</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <p class="text-2xl font-bold text-green-600">{{ result.packages_with_hash }}</p>
                    <p class="text-sm text-slate-500">í•´ì‹œ ì •ë³´ ë³´ìœ </p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-blue-600">{{ result.packages_with_homepage }}</p>
                    <p class="text-sm text-slate-500">í™ˆí˜ì´ì§€ ì •ë³´ ë³´ìœ </p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-purple-600">{{ result.packages_with_vcs }}</p>
                    <p class="text-sm text-slate-500">VCS ì •ë³´ ë³´ìœ </p>
                </div>
            </div>
        </div>

        <!-- ì˜ì¡´ì„± ë¶„ì„ -->
        {% if result.total_dependencies > 0 %}
        <div class="bg-white rounded-xl shadow-md border border-slate-200 p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-800 mb-4">ğŸ”— ì˜ì¡´ì„± ë¶„ì„</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <p class="text-2xl font-bold text-indigo-600">{{ result.dependency_stats.has_dependencies }}</p>
                    <p class="text-sm text-slate-500">ì˜ì¡´ì„±ì´ ìˆëŠ” íŒ¨í‚¤ì§€</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-slate-600">{{ result.dependency_stats.isolated_packages }}</p>
                    <p class="text-sm text-slate-500">ë…ë¦½ì ì¸ íŒ¨í‚¤ì§€</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-rose-600">{{ result.dependency_stats.max_dependencies }}</p>
                    <p class="text-sm text-slate-500">ìµœëŒ€ ì˜ì¡´ì„± ìˆ˜</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- íŒ¨í‚¤ì§€ ëª©ë¡ í…Œì´ë¸” -->
        <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-slate-800">ğŸ“¦ íŒ¨í‚¤ì§€ ìƒì„¸ ëª©ë¡</h2>
                    <div class="flex space-x-4">
                        <input type="text" id="search-input" placeholder="íŒ¨í‚¤ì§€ ê²€ìƒ‰..." 
                               class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                               onkeyup="searchPackages()">
                        <select id="type-filter" onchange="filterByType()" 
                                class="px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500">
                            <option value="">ëª¨ë“  íƒ€ì…</option>
                            {% for pkg_type, count in result.type_stats %}
                            <option value="{{ pkg_type }}">{{ pkg_type|capitalize }} ({{ count }})</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b">
                        <tr>
                            <th class="px-6 py-4 w-16">#</th>
                            <th class="px-6 py-4">íŒ¨í‚¤ì§€ëª…</th>
                            <th class="px-6 py-4">ë²„ì „</th>
                            <th class="px-6 py-4">íƒ€ì…</th>
                            <th class="px-6 py-4">ë¼ì´ì„ ìŠ¤</th>
                            <th class="px-6 py-4">ë³´ì•ˆ</th>
                            <th class="px-6 py-4">ì°¸ì¡°</th>
                        </tr>
                    </thead>
                    <tbody id="package-table-body" class="divide-y divide-slate-100">
                        {% for pkg in result.package_list %}
                        <tr class="hover:bg-slate-50 transition package-row {% if loop.index > 15 %}hidden-row{% endif %} {% if pkg.is_cicd %}cicd-row{% endif %}" 
                            data-name="{{ pkg.name|lower }}" data-type="{{ pkg.type }}">
                            <td class="px-6 py-4 text-slate-400 text-sm">{{ loop.index }}</td>
                            <td class="px-6 py-4 font-medium text-slate-800">
                                <div class="flex items-center">
                                    {{ pkg.name }}
                                    {% if pkg.is_cicd %}
                                    <span class="ml-2 text-[10px] bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded border border-amber-200 font-bold uppercase tracking-tight">CI/CD</span>
                                    {% endif %}
                                </div>
                                {% if pkg.purl %}
                                <p class="text-xs text-slate-400 font-mono mt-1">{{ pkg.purl[:50] }}{% if pkg.purl|length > 50 %}...{% endif %}</p>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 text-slate-600 font-mono text-sm">{{ pkg.version }}</td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded border border-blue-200 capitalize">{{ pkg.type }}</span>
                            </td>
                            <td class="px-6 py-4">
                                <span class="px-2 py-1 bg-slate-100 text-xs rounded border border-slate-200 text-slate-500">{{ pkg.license }}</span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex space-x-1">
                                    {% if pkg.has_hash %}
                                    <span class="text-green-500" title="í•´ì‹œ ì •ë³´ {{ pkg.hash_count }}ê°œ">ğŸ”’</span>
                                    {% endif %}
                                    {% if pkg.cpe %}
                                    <span class="text-blue-500" title="CPE ì‹ë³„ì">ğŸ†”</span>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex space-x-1">
                                    {% if pkg.has_homepage %}
                                    <span class="text-blue-500" title="í™ˆí˜ì´ì§€">ğŸ </span>
                                    {% endif %}
                                    {% if pkg.has_vcs %}
                                    <span class="text-green-500" title="VCS ì €ì¥ì†Œ">ğŸ“‚</span>
                                    {% endif %}
                                    {% if pkg.external_ref_count > 0 %}
                                    <span class="text-xs text-slate-400">({{ pkg.external_ref_count }})</span>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% if result.total_packages > 15 %}
            <div id="view-all-section" class="p-4 bg-slate-50 text-center border-t">
                <button onclick="showAllAndFilter()" class="bg-white border px-6 py-2 rounded-full text-sm font-semibold text-slate-600 hover:text-indigo-600 shadow-sm transition">
                    ì „ì²´ {{ result.total_packages }} ê°œ íŒ¨í‚¤ì§€ ëª¨ë‘ ë³´ê¸° â†“
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        function filterRows() {
            const isChecked = document.getElementById('cicd-filter').checked;
            const cicdRows = document.querySelectorAll('.cicd-row');
            cicdRows.forEach(row => {
                if (isChecked) row.classList.add('cicd-hidden');
                else row.classList.remove('cicd-hidden');
            });
            updateRowNumbers();
        }

        function showAllAndFilter() {
            document.querySelectorAll('.hidden-row').forEach(row => row.classList.remove('hidden-row'));
            document.getElementById('view-all-section').style.display = 'none';
            filterRows(); // í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€
            updateRowNumbers();
        }

        function searchPackages() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const rows = document.querySelectorAll('.package-row');
            
            rows.forEach(row => {
                const packageName = row.getAttribute('data-name');
                if (packageName.includes(searchTerm)) {
                    row.classList.remove('search-hidden');
                } else {
                    row.classList.add('search-hidden');
                }
            });
            updateRowNumbers();
        }

        function filterByType() {
            const selectedType = document.getElementById('type-filter').value;
            const rows = document.querySelectorAll('.package-row');
            
            rows.forEach(row => {
                const packageType = row.getAttribute('data-type');
                if (!selectedType || packageType === selectedType) {
                    row.classList.remove('type-hidden');
                } else {
                    row.classList.add('type-hidden');
                }
            });
            updateRowNumbers();
        }

        function updateRowNumbers() {
            const rows = document.querySelectorAll('.package-row');
            let visibleIndex = 1;
            
            rows.forEach(row => {
                const isVisible = !row.classList.contains('cicd-hidden') && 
                                !row.classList.contains('search-hidden') && 
                                !row.classList.contains('type-hidden') &&
                                !row.classList.contains('hidden-row');
                
                if (isVisible) {
                    row.style.display = '';
                    row.querySelector('td').textContent = visibleIndex++;
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
            const style = document.createElement('style');
            style.textContent = `
                .search-hidden, .type-hidden { display: none !important; }
                .package-row { transition: all 0.2s ease; }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>